select(Date, ClosingPrice = Last) %>%
mutate(ShiftedClosingPrice =lag(ClosingPrice, n=1))%>%
select(-"ClosingPrice")%>%rename("Close"=ShiftedClosingPrice)
Open=data%>%
filter(Time==as_hms("08:00:00"))%>%
select(Date,CurrentDayOpen=Open)
data=data%>%
left_join(ClosingPrice, by="Date")%>%
left_join(Open, by="Date")
rm(ClosingPrice, Open)
#create new column with previous day high and low
highprice = data%>%
group_by(Date)%>%
summarise(DayHigh=max(High, na.rm = TRUE))%>%
ungroup()%>%
mutate(PreviousDayHigh =lag(DayHigh, n=1))%>%
select(-"DayHigh")
lowprice = data%>%
group_by(Date)%>%
summarise(DayLow=min(Low, na.rm = TRUE))%>%
ungroup()%>%
mutate(PreviousDayLow =lag(DayLow, n=1))%>%
select(-"DayLow")
data=data%>%
left_join(highprice, by="Date")%>%
left_join(lowprice, by="Date")
rm(lowprice,highprice)
data<-data%>%
filter(!is.na(Close))%>%
filter(!is.na(PreviousDayHigh))%>%
filter(!is.na(PreviousDayLow))
##Eliminating outlier days, eliminating days with too little observations
data <- data %>%
group_by(Date) %>%
filter(n() == 40) %>%   # Keep only groups with exactly 40 rows
ungroup()
library(dplyr)
##Checking how many times within the dataset a gap between previous day close and current day open is being closed
datagap=data%>%
mutate(Gap= CurrentDayOpen-ClosingPrice,
GapMagnitude=abs(Gap))%>%
mutate(IsGapGreaterThan10=GapMagnitude>=20)
View(data)
library(tidyverse)
library(dplyr)
library(lubridate)
library(hms)
#create Column names
column_names <- c("Date", "Time", "Open", "High", "Low", "Last", "Volume", "# of Trades",
"OHLC Avg", "HLC Avg", "HL Avg", "Bid Volume", "Ask Volume",
"Point of Control", "Value Area High Value", "Value Area Low Value",
"Volume Weighted Average Price", "Previous Day Close Line",
"Previous Day High Line", "Previous Day Low Line",
"Daily Open at 08:00", "Cash Market Open at 09:00",
"Open", "High", "Low", "Close")
#Import data, delimited by comma
data = read_delim("./F.US.DDU24 [C][M]  30 Min  #4_GraphData.txt", delim = ",", col_names=column_names,skip=1 )
rm(column_names)
#Data wrangling
data=data%>%
mutate(Date=ymd(Date))%>%
mutate(Time = as_hms(Time))%>%
mutate(across(-c(Date,Time), as.numeric))%>%
rename(Open="Open...3", High="High...4", Low="Low...5")
data=data%>%
select(-"Previous Day Close Line",-"Previous Day Low Line",
-"Daily Open at 08:00", -"Cash Market Open at 09:00",-"Open...23",-"High...24",-"Low...25",-"Close",
-"Point of Control", -"Value Area High Value", -"Value Area Low Value",
-"Volume Weighted Average Price", -"Previous Day High Line")
#Explore data
colnames(data)
glimpse(data)
head(data)
#create new column with previous day close and currentday open
ClosingPrice = data %>%
filter(Time == as_hms("21:30:00")) %>%
select(Date, ClosingPrice = Last) %>%
mutate(ShiftedClosingPrice =lag(ClosingPrice, n=1))%>%
select(-"ClosingPrice")%>%rename("ClosingPrice"=ShiftedClosingPrice)
Open=data%>%
filter(Time==as_hms("08:00:00"))%>%
select(Date,CurrentDayOpen=Open)
data=data%>%
left_join(ClosingPrice, by="Date")%>%
left_join(Open, by="Date")
rm(ClosingPrice, Open)
#create new column with previous day high and low
highprice = data%>%
group_by(Date)%>%
summarise(DayHigh=max(High, na.rm = TRUE))%>%
ungroup()%>%
mutate(PreviousDayHigh =lag(DayHigh, n=1))%>%
select(-"DayHigh")
lowprice = data%>%
group_by(Date)%>%
summarise(DayLow=min(Low, na.rm = TRUE))%>%
ungroup()%>%
mutate(PreviousDayLow =lag(DayLow, n=1))%>%
select(-"DayLow")
data=data%>%
left_join(highprice, by="Date")%>%
left_join(lowprice, by="Date")
rm(lowprice,highprice)
data<-data%>%
filter(!is.na(Close))%>%
filter(!is.na(PreviousDayHigh))%>%
filter(!is.na(PreviousDayLow))
library(tidyverse)
library(dplyr)
library(lubridate)
library(hms)
#create Column names
column_names <- c("Date", "Time", "Open", "High", "Low", "Last", "Volume", "# of Trades",
"OHLC Avg", "HLC Avg", "HL Avg", "Bid Volume", "Ask Volume",
"Point of Control", "Value Area High Value", "Value Area Low Value",
"Volume Weighted Average Price", "Previous Day Close Line",
"Previous Day High Line", "Previous Day Low Line",
"Daily Open at 08:00", "Cash Market Open at 09:00",
"Open", "High", "Low", "Close")
#Import data, delimited by comma
data = read_delim("./F.US.DDU24 [C][M]  30 Min  #4_GraphData.txt", delim = ",", col_names=column_names,skip=1 )
rm(column_names)
#Data wrangling
data=data%>%
mutate(Date=ymd(Date))%>%
mutate(Time = as_hms(Time))%>%
mutate(across(-c(Date,Time), as.numeric))%>%
rename(Open="Open...3", High="High...4", Low="Low...5")
data=data%>%
select(-"Previous Day Close Line",-"Previous Day Low Line",
-"Daily Open at 08:00", -"Cash Market Open at 09:00",-"Open...23",-"High...24",-"Low...25",-"Close",
-"Point of Control", -"Value Area High Value", -"Value Area Low Value",
-"Volume Weighted Average Price", -"Previous Day High Line")
#Explore data
colnames(data)
glimpse(data)
head(data)
#create new column with previous day close and currentday open
ClosingPrice = data %>%
filter(Time == as_hms("21:30:00")) %>%
select(Date, ClosingPrice = Last) %>%
mutate(ShiftedClosingPrice =lag(ClosingPrice, n=1))%>%
select(-"ClosingPrice")%>%rename("ClosingPrice"=ShiftedClosingPrice)
Open=data%>%
filter(Time==as_hms("08:00:00"))%>%
select(Date,CurrentDayOpen=Open)
data=data%>%
left_join(ClosingPrice, by="Date")%>%
left_join(Open, by="Date")
rm(ClosingPrice, Open)
#create new column with previous day high and low
highprice = data%>%
group_by(Date)%>%
summarise(DayHigh=max(High, na.rm = TRUE))%>%
ungroup()%>%
mutate(PreviousDayHigh =lag(DayHigh, n=1))%>%
select(-"DayHigh")
lowprice = data%>%
group_by(Date)%>%
summarise(DayLow=min(Low, na.rm = TRUE))%>%
ungroup()%>%
mutate(PreviousDayLow =lag(DayLow, n=1))%>%
select(-"DayLow")
data=data%>%
left_join(highprice, by="Date")%>%
left_join(lowprice, by="Date")
rm(lowprice,highprice)
data<-data%>%
filter(!is.na(ClosingPrice))%>%
filter(!is.na(PreviousDayHigh))%>%
filter(!is.na(PreviousDayLow))
##Eliminating outlier days, eliminating days with too little observations
data <- data %>%
group_by(Date) %>%
filter(n() == 40) %>%   # Keep only groups with exactly 40 rows
ungroup()
library(dplyr)
##Checking how many times within the dataset a gap between previous day close and current day open is being closed
datagap=data%>%
mutate(Gap= CurrentDayOpen-ClosingPrice,
GapMagnitude=abs(Gap))%>%
mutate(IsGapGreaterThan10=GapMagnitude>=20)
#Check if gap has been closed during the day
datagap = datagap%>%
filter(Time>=as_hms("08:00:00"))%>%
group_by(Date) %>%
group_by(Date)%>%
mutate(GapClosed=case_when(IsGapGreaterThan10 & Gap >0 &Low <= ClosingPrice ~ TRUE,
IsGapGreaterThan10 & Gap <0 &High >= ClosingPrice ~ TRUE,
TRUE ~ FALSE))%>% ungroup()
##Summarizing
Gap_Results = datagap %>%
group_by(Date) %>%
summarize(
ClosingPrice=first(ClosingPrice),
CurrentDayOpen = first(CurrentDayOpen),
Gap=first(Gap),
IsGapGreaterThan10=first(IsGapGreaterThan10),
GapClosed=any(GapClosed)
)
Gap_Results=Gap_Results%>%
mutate(GapInd=if_else(GapClosed & IsGapGreaterThan10 , 1, 0))%>%
mutate(noGap=if_else(IsGapGreaterThan10,0,1))
SumGapClosed=sum(Gap_Results$GapInd)
SumNoGap=sum(Gap_Results$noGap,na.rm=TRUE)
SumGapClosed/(201-SumNoGap)
SumNoGap
SumGapClosed
View(data)
length(Gap_Results)
View(Gap_Results)
SumGapClosed/(248-SumNoGap)
248-SumNoGap
analyze_gap_closure(datagap, "both",20,1500)
###Creating Statistics for 10+ years of data of DAX futures
###Uploading and cleaning data
#create Column names
column_names <- c("Date", "Time", "Open", "High", "Low", "Last", "Volume", "# of Trades",
"OHLC Avg", "HLC Avg", "HL Avg", "Bid Volume", "Ask Volume")
data = read_delim("./F.US.DDU24(5000Days).txt", delim = ",", col_names=column_names,skip=1 )
rm(column_names)
#Data wrangling
data=data%>%
mutate(Date=ymd(Date))%>%
mutate(Time = as_hms(Time))%>%
mutate(across(-c(Date,Time), as.numeric))%>%
select(-"# of Trades", -"OHLC Avg",-"HLC Avg",-"HL Avg", -"Bid Volume", -"Ask Volume")
#create new column with previous day high and low
highprice = data%>%
group_by(Date)%>%
summarise(DayHigh=max(High, na.rm = TRUE))%>%
ungroup()%>%
mutate(PreviousDayHigh =lag(DayHigh, n=1))%>%
select(-"DayHigh")
lowprice = data%>%
group_by(Date)%>%
summarise(DayLow=min(Low, na.rm = TRUE))%>%
ungroup()%>%
mutate(PreviousDayLow =lag(DayLow, n=1))%>%
select(-"DayLow")
data=data%>%
left_join(highprice, by="Date")%>%
left_join(lowprice, by="Date")
rm(lowprice,highprice)
View(data)
ClosingPrice = data %>%
filter(Time == as_hms("21:30:00")) %>%
select(Date, ClosingPrice = Last) %>%
mutate(ShiftedClosingPrice =lag(ClosingPrice, n=1))%>%
select(-"ClosingPrice")%>%rename("ClosingPrice"=ShiftedClosingPrice)
Open=data%>%
filter(Time==as_hms("08:00:00"))%>%
select(Date,CurrentDayOpen=Open)
data=data%>%
left_join(ClosingPrice, by="Date")%>%
left_join(Open, by="Date")
rm(ClosingPrice, Open)
#Eliminate NAs
data<-data%>%
filter(!is.na(ClosingPrice))%>%
filter(!is.na(PreviousDayHigh))%>%
filter(!is.na(PreviousDayLow))
##Eliminating outlier days, eliminating days with too little observations
data <- data %>%
group_by(Date) %>%
filter(n() == 40) %>%   # Keep only groups with exactly 40 rows
ungroup()
28*0.5
###Creating Statistics for 10+ years of data of DAX futures
###Uploading and cleaning data
#create Column names
column_names <- c("Date", "Time", "Open", "High", "Low", "Last", "Volume", "# of Trades",
"OHLC Avg", "HLC Avg", "HL Avg", "Bid Volume", "Ask Volume")
data = read_delim("./F.US.DDU24(5000Days).txt", delim = ",", col_names=column_names,skip=1 )
rm(column_names)
#Data wrangling
data=data%>%
mutate(Date=ymd(Date))%>%
mutate(Time = as_hms(Time))%>%
mutate(across(-c(Date,Time), as.numeric))%>%
select(-"# of Trades", -"OHLC Avg",-"HLC Avg",-"HL Avg", -"Bid Volume", -"Ask Volume")
#create new column with previous day high and low
highprice = data%>%
group_by(Date)%>%
summarise(DayHigh=max(High, na.rm = TRUE))%>%
ungroup()%>%
mutate(PreviousDayHigh =lag(DayHigh, n=1))%>%
select(-"DayHigh")
lowprice = data%>%
group_by(Date)%>%
summarise(DayLow=min(Low, na.rm = TRUE))%>%
ungroup()%>%
mutate(PreviousDayLow =lag(DayLow, n=1))%>%
select(-"DayLow")
data=data%>%
left_join(highprice, by="Date")%>%
left_join(lowprice, by="Date")
rm(lowprice,highprice)
#create new column with previous day close and current day open
ClosingPrice = data %>%
filter(Time == as_hms("21:30:00")) %>%
select(Date, ClosingPrice = Last) %>%
mutate(ShiftedClosingPrice =lag(ClosingPrice, n=1))%>%
select(-"ClosingPrice")%>%rename("ClosingPrice"=ShiftedClosingPrice)
Open=data%>%
filter(Time==as_hms("08:00:00"))%>%
select(Date,CurrentDayOpen=Open)
data=data%>%
left_join(ClosingPrice, by="Date")%>%
left_join(Open, by="Date")
rm(ClosingPrice, Open)
#Eliminate NAs
data<-data%>%
filter(!is.na(ClosingPrice))%>%
filter(!is.na(PreviousDayHigh))%>%
filter(!is.na(PreviousDayLow))
##Eliminating outlier days, eliminating days with too little observations
data <- data %>%
group_by(Date) %>%
filter(n() == 28) %>%   # Keep only groups with exactly 40 rows
ungroup()
library(tidyverse)
library(dplyr)
library(lubridate)
library(hms)
###Creating Statistics for 10+ years of data of DAX futures
###Uploading and cleaning data
#create Column names
column_names <- c("Date", "Time", "Open", "High", "Low", "Last", "Volume", "# of Trades",
"OHLC Avg", "HLC Avg", "HL Avg", "Bid Volume", "Ask Volume")
data = read_delim("./F.US.DDU24(5000Days).txt", delim = ",", col_names=column_names,skip=1 )
rm(column_names)
#Data wrangling
data=data%>%
mutate(Date=ymd(Date))%>%
mutate(Time = as_hms(Time))%>%
mutate(across(-c(Date,Time), as.numeric))%>%
select(-"# of Trades", -"OHLC Avg",-"HLC Avg",-"HL Avg", -"Bid Volume", -"Ask Volume")
#create new column with previous day high and low
highprice = data%>%
group_by(Date)%>%
summarise(DayHigh=max(High, na.rm = TRUE))%>%
ungroup()%>%
mutate(PreviousDayHigh =lag(DayHigh, n=1))%>%
select(-"DayHigh")
lowprice = data%>%
group_by(Date)%>%
summarise(DayLow=min(Low, na.rm = TRUE))%>%
ungroup()%>%
mutate(PreviousDayLow =lag(DayLow, n=1))%>%
select(-"DayLow")
data=data%>%
left_join(highprice, by="Date")%>%
left_join(lowprice, by="Date")
rm(lowprice,highprice)
#create new column with previous day close and current day open
ClosingPrice = data %>%
filter(Time == as_hms("21:30:00")) %>%
select(Date, ClosingPrice = Last) %>%
mutate(ShiftedClosingPrice =lag(ClosingPrice, n=1))%>%
select(-"ClosingPrice")%>%rename("ClosingPrice"=ShiftedClosingPrice)
Open=data%>%
filter(Time==as_hms("08:00:00"))%>%
select(Date,CurrentDayOpen=Open)
data=data%>%
left_join(ClosingPrice, by="Date")%>%
left_join(Open, by="Date")
rm(ClosingPrice, Open)
#Eliminate NAs
data<-data%>%
filter(!is.na(ClosingPrice))%>%
filter(!is.na(PreviousDayHigh))%>%
filter(!is.na(PreviousDayLow))
##Eliminating outlier days, eliminating days with too little observations
data <- data %>%
group_by(Date) %>%
filter(n() >= 28) %>%   # Keep only groups with exactly 40 rows
ungroup()
library(tidyverse)
library(dplyr)
library(lubridate)
library(hms)
###Creating Statistics for 10+ years of data of DAX futures
###Uploading and cleaning data
#create Column names
column_names <- c("Date", "Time", "Open", "High", "Low", "Last", "Volume", "# of Trades",
"OHLC Avg", "HLC Avg", "HL Avg", "Bid Volume", "Ask Volume")
data = read_delim("./F.US.DDU24(5000Days).txt", delim = ",", col_names=column_names,skip=1 )
rm(column_names)
#Data wrangling
data=data%>%
mutate(Date=ymd(Date))%>%
mutate(Time = as_hms(Time))%>%
mutate(across(-c(Date,Time), as.numeric))%>%
select(-"# of Trades", -"OHLC Avg",-"HLC Avg",-"HL Avg", -"Bid Volume", -"Ask Volume")
#create new column with previous day high and low
highprice = data%>%
group_by(Date)%>%
summarise(DayHigh=max(High, na.rm = TRUE))%>%
ungroup()%>%
mutate(PreviousDayHigh =lag(DayHigh, n=1))%>%
select(-"DayHigh")
lowprice = data%>%
group_by(Date)%>%
summarise(DayLow=min(Low, na.rm = TRUE))%>%
ungroup()%>%
mutate(PreviousDayLow =lag(DayLow, n=1))%>%
select(-"DayLow")
data=data%>%
left_join(highprice, by="Date")%>%
left_join(lowprice, by="Date")
rm(lowprice,highprice)
#create new column with previous day close and current day open
ClosingPrice = data %>%
filter(Time == as_hms("21:30:00")) %>%
select(Date, ClosingPrice = Last) %>%
mutate(ShiftedClosingPrice =lag(ClosingPrice, n=1))%>%
select(-"ClosingPrice")%>%rename("ClosingPrice"=ShiftedClosingPrice)
Open=data%>%
filter(Time==as_hms("08:00:00"))%>%
select(Date,CurrentDayOpen=Open)
data=data%>%
left_join(ClosingPrice, by="Date")%>%
left_join(Open, by="Date")
rm(ClosingPrice, Open)
#Eliminate NAs
data<-data%>%
filter(!is.na(ClosingPrice))%>%
filter(!is.na(PreviousDayHigh))%>%
filter(!is.na(PreviousDayLow))
##Eliminating outlier days, eliminating days with too little observations
data <- data %>%
group_by(Date) %>%
filter(n() >= 28) %>%   # Keep only groups with exactly 40 rows
ungroup()
datagap=data%>%
mutate(Gap= CurrentDayOpen-ClosingPrice,
GapMagnitude=abs(Gap))
View(datagap)
library(tidyverse)
library(dplyr)
library(lubridate)
library(hms)
###Creating Statistics for 10+ years of data of DAX futures
###Uploading and cleaning data
#create Column names
column_names <- c("Date", "Time", "Open", "High", "Low", "Last", "Volume", "# of Trades",
"OHLC Avg", "HLC Avg", "HL Avg", "Bid Volume", "Ask Volume")
data = read_delim("./F.US.DDU24(5000Days).txt", delim = ",", col_names=column_names,skip=1 )
rm(column_names)
#Data wrangling
data=data%>%
mutate(Date=ymd(Date))%>%
mutate(Time = as_hms(Time))%>%
mutate(across(-c(Date,Time), as.numeric))%>%
select(-"# of Trades", -"OHLC Avg",-"HLC Avg",-"HL Avg", -"Bid Volume", -"Ask Volume")
#create new column with previous day high and low
highprice = data%>%
group_by(Date)%>%
summarise(DayHigh=max(High, na.rm = TRUE))%>%
ungroup()%>%
mutate(PreviousDayHigh =lag(DayHigh, n=1))%>%
select(-"DayHigh")
lowprice = data%>%
group_by(Date)%>%
summarise(DayLow=min(Low, na.rm = TRUE))%>%
ungroup()%>%
mutate(PreviousDayLow =lag(DayLow, n=1))%>%
select(-"DayLow")
data=data%>%
left_join(highprice, by="Date")%>%
left_join(lowprice, by="Date")
rm(lowprice,highprice)
#create new column with previous day close and current day open
ClosingPrice = data %>%
filter(Time == as_hms("21:30:00")) %>%
select(Date, ClosingPrice = Last) %>%
mutate(ShiftedClosingPrice =lag(ClosingPrice, n=1))%>%
select(-"ClosingPrice")%>%rename("ClosingPrice"=ShiftedClosingPrice)
Open=data%>%
filter(Time==as_hms("08:00:00"))%>%
select(Date,CurrentDayOpen=Open)
data=data%>%
left_join(ClosingPrice, by="Date")%>%
left_join(Open, by="Date")
rm(ClosingPrice, Open)
#Eliminate NAs
data<-data%>%
filter(!is.na(ClosingPrice))%>%
filter(!is.na(PreviousDayHigh))%>%
filter(!is.na(PreviousDayLow))
##Eliminating outlier days, eliminating days with too little observations
data <- data %>%
group_by(Date) %>%
filter(n() >= 28) %>%   # Keep only groups with exactly 40 rows
ungroup()
#Create Gap Variable
datagap=data%>%
mutate(Gap= CurrentDayOpen-ClosingPrice)
datagap=data%>%
mutate(Gap= CurrentDayOpen-ClosingPrice)%>%
filter(!is.na(Gap))
Both10tomax=analyze_gap_closure(datagap,"both",10)
Both200tomax=analyze_gap_closure(datagap,"both",20)
Both30tomax=analyze_gap_closure(datagap,"both",30)
Both40tomax=analyze_gap_closure(datagap,"both",40)
Both10to40=analyze_gap_closure(datagap,"both",10,40)
Pos10to40=analyze_gap_closure(datagap,"positive",10,40)
Pos10to30=analyze_gap_closure(datagap,"positive",10,30)
Neg10to30=analyze_gap_closure(datagap,"negative",10,30)
Pos10to20=analyze_gap_closure(datagap,"positive",10,20)
Neg10to20=analyze_gap_closure(datagap,"negative",10,20)
